import { isEthereumWallet } from '@dynamic-labs/ethereum';

const USDC_ADDRESS = "0xF1815bd50389c46847f0Bda824eC8da914045D14";

const HODLJarABI = [
  {
    name: 'constructor',
    type: 'constructor',
    stateMutability: 'nonpayable',
    inputs: [
      { name: '_usdc', type: 'address' },
      { name: '_kidname', type: 'string' },
      { name: '_story', type: 'string' },
      { name: '_age', type: 'uint256' },
      { name: '_fosterHome', type: 'address' },
      { name: '_hodlJarListing', type: 'address' }
    ]
  },
  {
    name: 'deposit',
    type: 'function',
    stateMutability: 'nonpayable',
    inputs: [
      { name: 'assets', type: 'uint256' },
      { name: 'receiver', type: 'address' }
    ],
    outputs: [{ type: 'uint256' }]
  }
];

// Your contract bytecode from the compilation
const bytecode = "0x61010060405273bc92aac2dbbf42215248b5688eb3d3d2b32f2c8d73ffffffffffffffffffffffffffffffffffffffff1660e09073ffffffffffffffffffffffffffffffffffffffff1681525034801561005857600080fd5b50604051614239380380614239833981810160405281019061007a9190610802565b858560405160200161008c9190610934565b604051602081830303815290604052866040516020016100ac9190610980565b60405160208183030381529060405281600390816100ca9190610bb2565b5080600490816100da9190610bb2565b5050506000806100ef836104e960201b60201c565b91509150816100ff576012610101565b805b60ff1660a08160ff16815250508273ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff16815250505050506001600581905550600073ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff16036101bc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101b390610ce1565b60405180910390fd5b6000855111610200576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101f790610d4d565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361026f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161026690610db9565b60405180910390fd5b60008311801561027f5750601283105b6102be576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102b590610e25565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff160361032d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161032490610e91565b60405180910390fd5b8573ffffffffffffffffffffffffffffffffffffffff1660c08173ffffffffffffffffffffffffffffffffffffffff168152505080600d60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555084600690816103b19190610bb2565b5083600790816103c19190610bb2565b5081600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000600960006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555082600a819055506000600b819055506000600c81905550600d60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166325795bf26040518163ffffffff1660e01b8152600401600060405180830381600087803b1580156104c657600080fd5b505af11580156104da573d6000803e3d6000fd5b50505050505050505050610f3c565b6000806000808473ffffffffffffffffffffffffffffffffffffffff1660405160240160405160208183030381529060405263313ce56760e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505060405161055e9190610ef8565b600060405180830381855afa9150503d8060008114610599576040519150601f19603f3d011682016040523d82523d6000602084013e61059e565b606091505b50915091508180156105b257506020815110155b156105ea576000818060200190518101906105cd9190610f0f565b905060ff801681116105e857600181945094505050506105f4565b505b6000809350935050505b915091565b6000604051905090565b600080fd5b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006106388261060d565b9050919050565b6106488161062d565b811461065357600080fd5b50565b6000815190506106658161063f565b92915050565b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6106be82610675565b810181811067ffffffffffffffff821117156106dd576106dc610686565b5b80604052505050565b60006106f06105f9565b90506106fc82826106b5565b919050565b600067ffffffffffffffff82111561071c5761071b610686565b5b61072582610675565b9050602081019050919050565b60005b83811015610750578082015181840152602081019050610735565b60008484015250505050565b600061076f61076a84610701565b6106e6565b90508281526020810184848401111561078b5761078a610670565b5b610796848285610732565b509392505050565b600082601f8301126107b3576107b261066b565b5b81516107c384826020860161075c565b91505092915050565b6000819050919050565b6107df816107cc565b81146107ea57600080fd5b50565b6000815190506107fc816107d6565b92915050565b60008060008060008060c0878903121561081f5761081e610603565b5b600061082d89828a01610656565b965050602087015167ffffffffffffffff81111561084e5761084d610608565b5b61085a89828a0161079e565b955050604087015167ffffffffffffffff81111561087b5761087a610608565b5b61088789828a0161079e565b945050606061089889828a016107ed565b93505060806108a989828a01610656565b92505060a06108ba89828a01610656565b9150509295509295509295565b7f484f444c204a6172202d20000000000000000000000000000000000000000000815250565b600081519050919050565b600081905092915050565b600061090e826108ed565b61091881856108f8565b9350610928818560208601610732565b80840191505092915050565b600061093f826108c7565b600b8201915061094f8284610903565b915081905092915050565b7f484f444c2d000000000000000000000000000000000000000000000000000000815250565b600061098b8261095a565b60058201915061099b8284610903565b915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806109ed57607f821691505b602082108103610a00576109ff6109a6565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302610a687fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610a2b565b610a728683610a2b565b95508019841693508086168417925050509392505050565b6000819050919050565b6000610aaf610aaa610aa5846107cc565b610a8a565b6107cc565b9050919050565b6000819050919050565b610ac983610a94565b610add610ad582610ab6565b848454610a38565b825550505050565b600090565b610af2610ae5565b610afd818484610ac0565b505050565b5b81811015610b2157610b16600082610aea565b600181019050610b03565b5050565b601f821115610b6657610b3781610a06565b610b4084610a1b565b81016020851015610b4f578190505b610b63610b5b85610a1b565b830182610b02565b50505b505050565b600082821c905092915050565b6000610b8960001984600802610b6b565b1980831691505092915050565b6000610ba28383610b78565b9150826002028217905092915050565b610bbb826108ed565b67ffffffffffffffff811115610bd457610bd3610686565b5b610bde82546109d5565b610be9828285610b25565b600060209050601f831160018114610c1c5760008415610c0a578287015190505b610c148582610b96565b865550610c7c565b601f198416610c2a86610a06565b60005b82811015610c5257848901518255600182019150602085019450602081019050610c2d565b86831015610c6f5784890151610c6b601f891682610b78565b8355505b6001600288020188555050505b505050505050565b600082825260208201905092915050565b7f496e76616c696420555344432061646472657373000000000000000000000000600082015250565b6000610ccb601483610c84565b9150610cd682610c95565b602082019050919050565b60006020820190508181036000830152610cfa81610cbe565b9050919050565b7f4e616d652063616e6e6f7420626520656d707479000000000000000000000000600082015250565b6000610d37601483610c84565b9150610d4282610d01565b602082019050919050565b60006020820190508181036000830152610d6681610d2a565b9050919050565b7f496e76616c696420666f7374657220686f6d6520616464726573730000000000600082015250565b6000610da3601b83610c84565b9150610dae82610d6d565b602082019050919050565b60006020820190508181036000830152610dd281610d96565b9050919050565b7f416765206d757374206265206265747765656e203120616e6420313700000000600082015250565b6000610e0f601c83610c84565b9150610e1a82610dd9565b602082019050919050565b60006020820190508181036000830152610e3e81610e02565b9050919050565b7f496e76616c6964206c697374696e672061646472657373000000000000000000600082015250565b6000610e7b601783610c84565b9150610e8682610e45565b602082019050919050565b60006020820190508181036000830152610eaa81610e6e565b9050919050565b600081519050919050565b600081905092915050565b6000610ed282610eb1565b610edc8185610ebc565b9350610eec818560208601610732565b80840191505092915050565b6000610f048284610ec7565b915081905092915050565b600060208284031215610f2557610f24610603565b5b6000610f33848285016107ed565b91505092915050565b60805160a05160c05160e05161327e610fbb6000396000818161085701528181610fbc01528181611285015281816113ec015281816118be015281816119410152611aaf015260008181610ac901528181610ff801526112c201526000610a71015260008181610aa301528181611ff501526120e1015261327e6000f3fe608060405234801561001057600080fd5b50600436106102485760003560e01c806394bf804d1161013b578063bcaa16a2116100b8578063d905777e1161007c578063d905777e14610787578063dd62ed3e146107b7578063e037f889146107e7578063ef8b30f714610805578063f3ceca291461083557610248565b8063bcaa16a2146106bb578063c63d75b6146106d9578063c6e6f59214610709578063ce96cb7714610739578063d75f26b81461076957610248565b8063a9059cbb116100ff578063a9059cbb146105dd578063b3d7f6b91461060d578063b460af941461063d578063b91503a61461066d578063ba0876521461068b57610248565b806394bf804d1461053557806395d89b4114610565578063962ca496146105835780639e0fc6af146105a1578063a5854123146105bf57610248565b8063313ce567116101c95780634cdad5061161018d5780634cdad50614610469578063512ce164146104995780636e553f65146104b757806370a08231146104e75780637bf2da5d1461051757610248565b8063313ce567146103c157806338d52e0f146103df5780633e413bee146103fd578063402d267d1461041b57806346c922d11461044b57610248565b806318160ddd1161021057806318160ddd1461031957806323b872dd1461033757806325223bd414610367578063262a9dff146103855780632d4d8b48146103a357610248565b806301e1d1141461024d57806306fdde031461026b57806307a2d13a14610289578063095ea7b3146102b95780630a28a477146102e9575b600080fd5b610255610853565b60405161026291906125a0565b60405180910390f35b6102736108fd565b604051610280919061264b565b60405180910390f35b6102a3600480360381019061029e919061269e565b61098f565b6040516102b091906125a0565b60405180910390f35b6102d360048036038101906102ce9190612729565b6109a3565b6040516102e09190612784565b60405180910390f35b61030360048036038101906102fe919061269e565b6109c6565b60405161031091906125a0565b60405180910390f35b6103216109da565b60405161032e91906125a0565b60405180910390f35b610351600480360381019061034c919061279f565b6109e4565b60405161035e9190612784565b60405180910390f35b61036f610a13565b60405161037c9190612801565b60405180910390f35b61038d610a39565b60405161039a91906125a0565b60405180910390f35b6103ab610a3f565b6040516103b89190612801565b60405180910390f35b6103c9610a65565b6040516103d69190612838565b60405180910390f35b6103e7610a9f565b6040516103f49190612801565b60405180910390f35b610405610ac7565b60405161041291906128b2565b60405180910390f35b610435600480360381019061043091906128cd565b610aeb565b60405161044291906125a0565b60405180910390f35b610453610b15565b604051610460919061264b565b60405180910390f35b610483600480360381019061047e919061269e565b610ba3565b60405161049091906125a0565b60405180910390f35b6104a1610bb7565b6040516104ae91906125a0565b60405180910390f35b6104d160048036038101906104cc91906128fa565b610c09565b6040516104de91906125a0565b60405180910390f35b61050160048036038101906104fc91906128cd565b610e03565b60405161050e91906125a0565b60405180910390f35b61051f610e4b565b60405161052c9190612784565b60405180910390f35b61054f600480360381019061054a91906128fa565b610ea4565b60405161055c91906125a0565b60405180910390f35b61056d610f26565b60405161057a919061264b565b60405180910390f35b61058b610fb8565b60405161059891906125a0565b60405180910390f35b6105a9611079565b6040516105b69190612801565b60405180910390f35b6105c761109f565b6040516105d491906125a0565b60405180910390f35b6105f760048036038101906105f29190612729565b6110a5565b6040516106049190612784565b60405180910390f35b6106276004803603810190610622919061269e565b6110c8565b60405161063491906125a0565b60405180910390f35b6106576004803603810190610652919061293a565b6110dc565b60405161066491906125a0565b60405180910390f35b6106756111ef565b60405161068291906125a0565b60405180910390f35b6106a560048036038101906106a0919061293a565b611366565b6040516106b291906125a0565b60405180910390f35b6106c36113ea565b6040516106d091906129ae565b60405180910390f35b6106f360048036038101906106ee91906128cd565b61140e565b60405161070091906125a0565b60405180910390f35b610723600480360381019061071e919061269e565b611438565b60405161073091906125a0565b60405180910390f35b610753600480360381019061074e91906128cd565b61144c565b60405161076091906125a0565b60405180910390f35b610771611468565b60405161077e919061264b565b60405180910390f35b6107a1600480360381019061079c91906128cd565b6114f6565b6040516107ae91906125a0565b60405180910390f35b6107d160048036038101906107cc91906129c9565b611508565b6040516107de91906125a0565b60405180910390f35b6107ef61158f565b6040516107fc91906125a0565b60405180910390f35b61081f600480360381019061081a919061269e565b611595565b60405161082c91906125a0565b60405180910390f35b61083d6115a9565b60405161084a91906125a0565b60405180910390f35b60007f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff1663d4fac45d3061089a610a9f565b6040518363ffffffff1660e01b81526004016108b7929190612a09565b602060405180830381865afa1580156108d4573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906108f89190612a47565b905090565b60606003805461090c90612aa3565b80601f016020809104026020016040519081016040528092919081815260200182805461093890612aa3565b80156109855780601f1061095a57610100808354040283529160200191610985565b820191906000526020600020905b81548152906001019060200180831161096857829003601f168201915b5050505050905090565b600061099c8260006115b1565b9050919050565b6000806109ae61160a565b90506109bb818585611612565b600191505092915050565b60006109d3826001611624565b9050919050565b6000600254905090565b6000806109ef61160a565b90506109fc85828561167d565b610a07858585611712565b60019150509392505050565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600a5481565b600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000610a6f611806565b7f0000000000000000000000000000000000000000000000000000000000000000610a9a9190612b03565b905090565b60007f0000000000000000000000000000000000000000000000000000000000000000905090565b7f000000000000000000000000000000000000000000000000000000000000000081565b60007fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9050919050565b60078054610b2290612aa3565b80601f0160208091040260200160405190810160405280929190818152602001828054610b4e90612aa3565b8015610b9b5780601f10610b7057610100808354040283529160200191610b9b565b820191906000526020600020905b815481529060010190602001808311610b7e57829003601f168201915b505050505081565b6000610bb08260006115b1565b9050919050565b6000806301e13380600a546012610bce9190612b38565b610bd89190612b6c565b600c54610be59190612bae565b905080421015610c00574281610bfb9190612b38565b610c03565b60005b91505090565b60008073ffffffffffffffffffffffffffffffffffffffff16600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610c9b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c9290612c2e565b60405180910390fd5b631dcd65008314610ce1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cd890612cc0565b60405180910390fd5b6000610ced848461180b565b905033600960006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555083600b8190555042600c81905550600d60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d91c98ac6040518163ffffffff1660e01b8152600401600060405180830381600087803b158015610da857600080fd5b505af1158015610dbc573d6000803e3d6000fd5b505050507f264f630d9efa0d07053a31163641d9fcc0adafc9d9e76f1c37c2ce3a558d2c523385604051610df1929190612ce0565b60405180910390a18091505092915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b60008073ffffffffffffffffffffffffffffffffffffffff16600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415905090565b600080610eb08361140e565b905080841115610efb578284826040517f284ff667000000000000000000000000000000000000000000000000000000008152600401610ef293929190612d09565b60405180910390fd5b6000610f06856110c8565b9050610f1b610f1361160a565b85838861188d565b809250505092915050565b606060048054610f3590612aa3565b80601f0160208091040260200160405190810160405280929190818152602001828054610f6190612aa3565b8015610fae5780601f10610f8357610100808354040283529160200191610fae565b820191906000526020600020905b815481529060010190602001808311610f9157829003601f168201915b5050505050905090565b60007f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff1663c4f9870b7f00000000000000000000000000000000000000000000000000000000000000006040518263ffffffff1660e01b81526004016110339190612801565b602060405180830381865afa158015611050573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906110749190612a47565b905090565b600d60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600c5481565b6000806110b061160a565b90506110bd818585611712565b600191505092915050565b60006110d58260016115b1565b9050919050565b6000600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461116e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161116590612d8c565b60405180910390fd5b6301e13380600a5460126111829190612b38565b61118c9190612b6c565b600c546111999190612bae565b4210156111db576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016111d290612e1e565b60405180910390fd5b6111e6848484611a29565b90509392505050565b60008073ffffffffffffffffffffffffffffffffffffffff16600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603611281576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161127890612e8a565b60405180910390fd5b60007f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff1663d4fac45d307f00000000000000000000000000000000000000000000000000000000000000006040518363ffffffff1660e01b81526004016112fe929190612a09565b602060405180830381865afa15801561131b573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061133f9190612a47565b9050600b548111611351576000611360565b600b548161135f9190612b38565b5b91505090565b600080611372836114f6565b9050808511156113bd578285826040517fb94abeec0000000000000000000000000000000000000000000000000000000081526004016113b493929190612d09565b60405180910390fd5b60006113c886610ba3565b90506113de6113d561160a565b8686848a611aad565b80925050509392505050565b7f000000000000000000000000000000000000000000000000000000000000000081565b60007fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9050919050565b6000611445826000611624565b9050919050565b600061146161145a83610e03565b60006115b1565b9050919050565b6006805461147590612aa3565b80601f01602080910402602001604051908101604052809291908181526020018280546114a190612aa3565b80156114ee5780601f106114c3576101008083540402835291602001916114ee565b820191906000526020600020905b8154815290600101906020018083116114d157829003601f168201915b505050505081565b600061150182610e03565b9050919050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600b5481565b60006115a2826000611624565b9050919050565b631dcd650081565b600061160260016115c0610853565b6115ca9190612bae565b6115d2611806565b600a6115de9190612fdd565b6115e66109da565b6115f09190612bae565b8486611ba5909392919063ffffffff16565b905092915050565b600033905090565b61161f8383836001611bf4565b505050565b6000611675611631611806565b600a61163d9190612fdd565b6116456109da565b61164f9190612bae565b6001611659610853565b6116639190612bae565b8486611ba5909392919063ffffffff16565b905092915050565b60006116898484611508565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81101561170c57818110156116fc578281836040517ffb8f41b20000000000000000000000000000000000000000000000000000000081526004016116f393929190612d09565b60405180910390fd5b61170b84848484036000611bf4565b5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036117845760006040517f96c6fd1e00000000000000000000000000000000000000000000000000000000815260040161177b9190612801565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036117f65760006040517fec442f050000000000000000000000000000000000000000000000000000000081526004016117ed9190612801565b60405180910390fd5b611801838383611dcb565b505050565b600090565b60008061181783610aeb565b905080841115611862578284826040517f79012fb200000000000000000000000000000000000000000000000000000000815260040161185993929190612d09565b60405180910390fd5b600061186d85611595565b905061188261187a61160a565b85878461188d565b809250505092915050565b61189984848484611ff0565b6118a1610a9f565b73ffffffffffffffffffffffffffffffffffffffff1663095ea7b37f0000000000000000000000000000000000000000000000000000000000000000846040518363ffffffff1660e01b81526004016118fb929190612ce0565b6020604051808303816000875af115801561191a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061193e9190613054565b507f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff166347e7ef24611983610a9f565b846040518363ffffffff1660e01b81526004016119a1929190612ce0565b6020604051808303816000875af11580156119c0573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906119e49190613054565b611a23576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611a1a906130cd565b60405180910390fd5b50505050565b600080611a358361144c565b905080851115611a80578285826040517ffe9cceec000000000000000000000000000000000000000000000000000000008152600401611a7793929190612d09565b60405180910390fd5b6000611a8b866109c6565b9050611aa1611a9861160a565b86868985611aad565b80925050509392505050565b7f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff1663f3fef3a3611af1610a9f565b846040518363ffffffff1660e01b8152600401611b0f929190612ce0565b6020604051808303816000875af1158015611b2e573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611b529190613054565b611b91576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611b8890613139565b60405180910390fd5b611b9e8585858585612093565b5050505050565b6000611bd5611bb38361218c565b8015611bd0575060008480611bcb57611bca613159565b5b868809115b6121ba565b611be08686866121c6565b611bea9190612bae565b9050949350505050565b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603611c665760006040517fe602df05000000000000000000000000000000000000000000000000000000008152600401611c5d9190612801565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603611cd85760006040517f94280d62000000000000000000000000000000000000000000000000000000008152600401611ccf9190612801565b60405180910390fd5b81600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508015611dc5578273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92584604051611dbc91906125a0565b60405180910390a35b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603611e1d578060026000828254611e119190612bae565b92505081905550611ef0565b60008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905081811015611ea9578381836040517fe450d38c000000000000000000000000000000000000000000000000000000008152600401611ea093929190612d09565b60405180910390fd5b8181036000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550505b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603611f395780600260008282540392505081905550611f86565b806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051611fe391906125a0565b60405180910390a3505050565b61201c7f00000000000000000000000000000000000000000000000000000000000000008530856122b4565b6120268382612336565b8273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fdcbc1c05240f31ff3ad067ef1ee35ce4997762752e3a095284754544f4c709d78484604051612085929190613188565b60405180910390a350505050565b8273ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff16146120d2576120d183868361167d565b5b6120dc83826123b8565b6121077f0000000000000000000000000000000000000000000000000000000000000000858461243a565b8273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff167ffbde797d201c681b91056529119e0b02407c7bb96a4a2c75c01fc9667232c8db858560405161217d929190613188565b60405180910390a45050505050565b6000600160028360038111156121a5576121a46131b1565b5b6121af91906131e0565b60ff16149050919050565b60008115159050919050565b6000808385029050600080198587098281108382030391505060008103612201578382816121f7576121f6613159565b5b04925050506122ad565b8084116122215761222061221b60008614601260116124b9565b6124d3565b5b600084868809905082811182039150808303925060008560000386169050808604955080840493506001818260000304019050808302841793506000600287600302189050808702600203810290508087026002038102905080870260020381029050808702600203810290508087026002038102905080870260020381029050808502955050505050505b9392505050565b612330848573ffffffffffffffffffffffffffffffffffffffff166323b872dd8686866040516024016122e993929190613211565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506124e5565b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036123a85760006040517fec442f0500000000000000000000000000000000000000000000000000000000815260040161239f9190612801565b60405180910390fd5b6123b460008383611dcb565b5050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361242a5760006040517f96c6fd1e0000000000000000000000000000000000000000000000000000000081526004016124219190612801565b60405180910390fd5b61243682600083611dcb565b5050565b6124b4838473ffffffffffffffffffffffffffffffffffffffff1663a9059cbb858560405160240161246d929190612ce0565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506124e5565b505050565b60006124c4846121ba565b82841802821890509392505050565b634e487b71600052806020526024601cfd5b600080602060008451602086016000885af180612508576040513d6000823e3d81fd5b3d92506000519150506000821461252357600181141561253f565b60008473ffffffffffffffffffffffffffffffffffffffff163b145b1561258157836040517f5274afe70000000000000000000000000000000000000000000000000000000081526004016125789190612801565b60405180910390fd5b50505050565b6000819050919050565b61259a81612587565b82525050565b60006020820190506125b56000830184612591565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b838110156125f55780820151818401526020810190506125da565b60008484015250505050565b6000601f19601f8301169050919050565b600061261d826125bb565b61262781856125c6565b93506126378185602086016125d7565b61264081612601565b840191505092915050565b600060208201905081810360008301526126658184612612565b905092915050565b600080fd5b61267b81612587565b811461268657600080fd5b50565b60008135905061269881612672565b92915050565b6000602082840312156126b4576126b361266d565b5b60006126c284828501612689565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006126f6826126cb565b9050919050565b612706816126eb565b811461271157600080fd5b50565b600081359050612723816126fd565b92915050565b600080604083850312156127405761273f61266d565b5b600061274e85828601612714565b925050602061275f85828601612689565b9150509250929050565b60008115159050919050565b61277e81612769565b82525050565b60006020820190506127996000830184612775565b92915050565b6000806000606084860312156127b8576127b761266d565b5b60006127c686828701612714565b93505060206127d786828701612714565b92505060406127e886828701612689565b9150509250925092565b6127fb816126eb565b82525050565b600060208201905061281660008301846127f2565b92915050565b600060ff82169050919050565b6128328161281c565b82525050565b600060208201905061284d6000830184612829565b92915050565b6000819050919050565b600061287861287361286e846126cb565b612853565b6126cb565b9050919050565b600061288a8261285d565b9050919050565b600061289c8261287f565b9050919050565b6128ac81612891565b82525050565b60006020820190506128c760008301846128a3565b92915050565b6000602082840312156128e3576128e261266d565b5b60006128f184828501612714565b91505092915050565b600080604083850312156129115761291061266d565b5b600061291f85828601612689565b925050602061293085828601612714565b9150509250929050565b6000806000606084860312156129535761295261266d565b5b600061296186828701612689565b935050602061297286828701612714565b925050604061298386828701612714565b9150509250925092565b60006129988261287f565b9050919050565b6129a88161298d565b82525050565b60006020820190506129c3600083018461299f565b92915050565b600080604083850312156129e0576129df61266d565b5b60006129ee85828601612714565b92505060206129ff85828601612714565b9150509250929050565b6000604082019050612a1e60008301856127f2565b612a2b60208301846127f2565b9392505050565b600081519050612a4181612672565b92915050565b600060208284031215612a5d57612a5c61266d565b5b6000612a6b84828501612a32565b91505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680612abb57607f821691505b602082108103612ace57612acd612a74565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000612b0e8261281c565b9150612b198361281c565b9250828201905060ff811115612b3257612b31612ad4565b5b92915050565b6000612b4382612587565b9150612b4e83612587565b9250828203905081811115612b6657612b65612ad4565b5b92915050565b6000612b7782612587565b9150612b8283612587565b9250828202612b9081612587565b91508282048414831517612ba757612ba6612ad4565b5b5092915050565b6000612bb982612587565b9150612bc483612587565b9250828201905080821115612bdc57612bdb612ad4565b5b92915050565b7f484f444c206a617220616c726561647920686173206120646f6e6f7200000000600082015250565b6000612c18601c836125c6565b9150612c2382612be2565b602082019050919050565b60006020820190508181036000830152612c4781612c0b565b9050919050565b7f4d757374206465706f73697420657861637420646f6e6174696f6e20616d6f7560008201527f6e74000000000000000000000000000000000000000000000000000000000000602082015250565b6000612caa6022836125c6565b9150612cb582612c4e565b604082019050919050565b60006020820190508181036000830152612cd981612c9d565b9050919050565b6000604082019050612cf560008301856127f2565b612d026020830184612591565b9392505050565b6000606082019050612d1e60008301866127f2565b612d2b6020830185612591565b612d386040830184612591565b949350505050565b7f4f6e6c7920666f7374657220686f6d652063616e207769746864726177000000600082015250565b6000612d76601d836125c6565b9150612d8182612d40565b602082019050919050565b60006020820190508181036000830152612da581612d69565b9050919050565b7f43616e6e6f7420776974686472617720756e74696c206b6964207475726e732060008201527f3138000000000000000000000000000000000000000000000000000000000000602082015250565b6000612e086022836125c6565b9150612e1382612dac565b604082019050919050565b60006020820190508181036000830152612e3781612dfb565b9050919050565b7f484f444c206a617220686173206e6f20646f6e6f720000000000000000000000600082015250565b6000612e746015836125c6565b9150612e7f82612e3e565b602082019050919050565b60006020820190508181036000830152612ea381612e67565b9050919050565b60008160011c9050919050565b6000808291508390505b6001851115612f0157808604811115612edd57612edc612ad4565b5b6001851615612eec5780820291505b8081029050612efa85612eaa565b9450612ec1565b94509492505050565b600082612f1a5760019050612fd6565b81612f285760009050612fd6565b8160018114612f3e5760028114612f4857612f77565b6001915050612fd6565b60ff841115612f5a57612f59612ad4565b5b8360020a915084821115612f7157612f70612ad4565b5b50612fd6565b5060208310610133831016604e8410600b8410161715612fac5782820a905083811115612fa757612fa6612ad4565b5b612fd6565b612fb98484846001612eb7565b92509050818404811115612fd057612fcf612ad4565b5b81810290505b9392505050565b6000612fe882612587565b9150612ff38361281c565b92506130207fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8484612f0a565b905092915050565b61303181612769565b811461303c57600080fd5b50565b60008151905061304e81613028565b92915050565b60006020828403121561306a5761306961266d565b5b60006130788482850161303f565b91505092915050565b7f4d4f5245204d61726b657473206465706f736974206661696c65640000000000600082015250565b60006130b7601b836125c6565b91506130c282613081565b602082019050919050565b600060208201905081810360008301526130e6816130aa565b9050919050565b7f4d4f5245204d61726b657473207769746864726177616c206661696c65640000600082015250565b6000613123601e836125c6565b915061312e826130ed565b602082019050919050565b6000602082019050818103600083015261315281613116565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b600060408201905061319d6000830185612591565b6131aa6020830184612591565b9392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b60006131eb8261281c565b91506131f68361281c565b92508261320657613205613159565b5b828206905092915050565b600060608201905061322660008301866127f2565b61323360208301856127f2565b6132406040830184612591565b94935050505056fea2646970667358221220f02967a6dee7a166880c86889235e4f326762b389bc0d22fe8d5d9dfd98c485664736f6c634300081c0033" // ... rest of the bytecode

export async function createHODLJar(primaryWallet, params) {
  if (!primaryWallet || !isEthereumWallet(primaryWallet)) {
    return {
      success: false,
      message: 'Invalid wallet connection'
    };
  }

  try {
    const walletClient = await primaryWallet.getWalletClient();
    const publicClient = await primaryWallet.getPublicClient();
    const hodlJarListingAddress = "0xE1e4514c4eDaFD43d6bCB073EB3bB3515f8C479c";

    // Log deployment parameters for debugging
    console.log('Starting deployment with parameters:', {
      usdc: USDC_ADDRESS,
      kidname: params.name,
      story: params.story,
      age: params.age,
      fosterHome: params.fosterHome,
      hodlJarListing: hodlJarListingAddress
    });

    // Validate inputs
    if (!params.name || !params.story || !params.fosterHome) {
      return {
        success: false,
        message: 'Missing required parameters'
      };
    }

    if (params.age <= 0 || params.age >= 18) {
      return {
        success: false,
        message: 'Age must be between 1 and 17'
      };
    }

    // Prepare the deployment transaction
    const deploymentPromise = walletClient.deployContract({
      abi: HODLJarABI,
      bytecode,
      args: [
        USDC_ADDRESS,
        params.name,
        params.story,
        window.BigInt(params.age),
        params.fosterHome,
        hodlJarListingAddress
      ],
      account: primaryWallet.address
    });

    // Add timeout handling
    const timeoutPromise = new Promise((_, reject) => {
      setTimeout(() => reject(new Error('Transaction confirmation timed out')), 180000); // 3 minutes
    });

    // Wait for either deployment or timeout
    const hash = await Promise.race([deploymentPromise, timeoutPromise]);
    console.log('Deployment transaction initiated:', hash);

    // Wait for confirmation
    const receipt = await publicClient.waitForTransactionReceipt({
      hash,
      timeout: 60_000, // 60 seconds for confirmation
      confirmations: 1 // Wait for 1 confirmation
    });

    if (receipt.status === 'success') {
      return {
        success: true,
        message: `HODL Jar deployed successfully! Contract address: ${receipt.contractAddress}`,
        contractAddress: receipt.contractAddress,
        hash
      };
    } else {
      return {
        success: false,
        message: 'Deployment failed. Please try again.',
        hash
      };
    }
  } catch (error) {
    console.error('Deployment error:', error);

    // Handle specific error types
    if (error.message.includes('Proposal expired')) {
      return {
        success: false,
        message: 'Please confirm the transaction in your wallet promptly. Try again.',
        error: error
      };
    }

    return {
      success: false,
      message: `Error deploying HODL Jar: ${error.message}`,
      error: error
    };
  }
}
